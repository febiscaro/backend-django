{% extends "base.html" %}
{% load static %}
{% block content %}

<!-- Fundo full-bleed -->
<div class="login-bg"></div>

<main class="login-viewport">
  <div class="login-card shadow-lg">

    <div class="text-center mb-3">
      <h1 class="h4 fw-semibold m-0 text-light">Entrar</h1>
      <p class="login-subtitle small m-0">Acesse sua conta do Enprodes Sys</p>
    </div>

    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger py-2 mb-3">{{ form.non_field_errors }}</div>
      {% endif %}

      <div class="mb-3">
        <label class="form-label text-light" for="id_username">CPF</label>
        <div class="input-group">
          <span class="input-group-text" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14Z"
                    fill="currentColor" opacity=".7"/>
            </svg>
          </span>
          <input id="id_username"
                 name="username"
                 type="text"
                 class="form-control{% if form.username.errors %} is-invalid{% endif %}"
                 placeholder="Somente números"
                 inputmode="numeric"
                 maxlength="11"
                 autocomplete="username"
                 value="{{ form.username.value|default_if_none:'' }}"
                 required
                 autofocus>
        </div>
        {% if form.username.errors %}
          <div class="invalid-feedback d-block">
            {{ form.username.errors|join:", " }}
          </div>
        {% else %}
          <div class="form-text text-light-50">Digite apenas os números do CPF (sem pontos/traço).</div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label class="form-label text-light" for="id_password">Senha</label>
        <div class="input-group">
          <span class="input-group-text" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M17 9V7a5 5 0 1 0-10 0v2H5v12h14V9Zm-8 0V7a3 3 0 0 1 6 0v2Z"
                    fill="currentColor" opacity=".7"/>
            </svg>
          </span>
          <input id="id_password"
                 name="password"
                 type="password"
                 class="form-control{% if form.password.errors %} is-invalid{% endif %}"
                 placeholder="Sua senha"
                 autocomplete="current-password"
                 required>
          <button class="btn btn-outline-secondary" type="button" id="togglePass" aria-label="Mostrar senha" tabindex="0">
            <svg id="icon-eye" width="18" height="18" viewBox="0 0 24 24" fill="none" focusable="false" aria-hidden="true">
              <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Zm0 12a5 5 0 1 1 5-5 5 5 0 0 1-5 5Z"
                    fill="currentColor"/>
            </svg>
          </button>
        </div>
        {% if form.password.errors %}
          <div class="invalid-feedback d-block">
            {{ form.password.errors|join:", " }}
          </div>
        {% endif %}
      </div>

      {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

      <button type="submit" class="btn btn-primary w-100 py-2 mb-2">Entrar</button>
    </form>

  </div>
</main>

<style>
  /* Deixa o fundo do base transparente para a imagem aparecer */
  body{ background: transparent !important; }

  /* ===== Fundo ocupando a tela toda com imagem + véu escuro ===== */
  .login-bg{
    position: fixed;
    inset: 0;
    z-index: 0; /* atrás do conteúdo */
    background-image:
      linear-gradient(rgba(10,15,26,.70), rgba(89, 116, 175, 0.7)),
      url("{% static 'images/login-bg.jpeg' %}"); /* <-- caminho correto */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-color: #0a0f1a; /* fallback */
  }
  @media (max-width: 768px){
    .login-bg{ background-attachment: scroll; }
  }

  /* ===== Centralização robusta no mobile ===== */
  .login-viewport{
    min-height:100vh;   /* fallback */
    min-height:100svh;  /* iOS safari */
    min-height:100dvh;  /* viewport dinâmico */
    display:flex;
    align-items:center;
    justify-content:center;
    padding: max(2rem, env(safe-area-inset-top)) 1rem max(2rem, env(safe-area-inset-bottom));
  }
  @media (max-height: 620px){
    .login-viewport{ align-items:flex-start; padding-top:1rem; }
  }

  /* ===== Card glass ===== */
  .login-card{
    width:min(92vw, 420px);
    border-radius:18px;
    padding:1.25rem 1.25rem 1rem;
    background:rgba(17,28,45,.68);
    backdrop-filter: blur(14px) saturate(140%);
    -webkit-backdrop-filter: blur(14px) saturate(140%);
    border:1px solid rgba(255,255,255,.12);
    color:#e9eef6;
  }
  .login-card .form-label,
  .login-card h1 { color:#e9eef6; }

  .login-subtitle{ color: rgba(255,255,255,.85); }
  .login-card .text-light-50 { color: rgba(233,238,246,.78); }

  .login-card .form-control,
  .login-card .input-group-text{
    background:rgba(255,255,255,.95);
    border-color:rgba(0,0,0,.1);
  }
  .login-card .form-control:focus{
    border-color: rgba(13,110,253,.6);
    box-shadow: 0 0 0 .2rem rgba(13,110,253,.15);
  }
  .login-card .btn-outline-secondary{
    border-color:rgba(0,0,0,.12);
    background:rgba(255,255,255,.9);
  }

  /* Corrige cor do feedback de erro no tema escuro do card */
  .login-card .invalid-feedback { color: #ffd8d6; }
  .login-card .alert-danger {
    background: rgba(220,53,69,.12);
    border: 1px solid rgba(220,53,69,.35);
    color: #ffd8d6;
  }
</style>

<script>
  // CPF somente números + alternar senha
  (function(){
    const cpf = document.getElementById('id_username');
    if (cpf){
      cpf.addEventListener('input', function(){
        this.value = this.value.replace(/\D/g,'').slice(0,11);
      });
    }
    const btn = document.getElementById('togglePass');
    const pwd = document.getElementById('id_password');
    btn?.addEventListener('click', function(){
      const isPwd = pwd.type === 'password';
      pwd.type = isPwd ? 'text' : 'password';
      this.setAttribute('aria-label', isPwd ? 'Ocultar senha' : 'Mostrar senha');
      const svg = this.querySelector('#icon-eye');
      if (!svg) return;
      svg.innerHTML = isPwd
        ? '<path d="M2 12c1.73 3.89 6 7 11 7a13.5 13.5 0 0 0 6.35-1.64l1.79 1.79 1.06-1.06-19-19-1.06 1.06 3.07 3.07A13.23 13.23 0 0 0 1 12Zm7.41-7.41 2.14 2.14A5 5 0 0 1 17 12a4.93 4.93 0 0 1-.5 2.16l1.6 1.6A9.93 9.93 0 0 0 21 12c-1.73-3.89-6-7-11-7a10.23 10.23 0 0 0-1.59.12Z" fill="currentColor"/>'
        : '<path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Zm0 12a5 5 0 1 1 5-5 5 5 0 0 1-5 5Z" fill="currentColor"/>';
    });
  })();
</script>

{% endblock %}
